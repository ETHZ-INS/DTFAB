---
title: "Figure 2"
author: "Pierre-Luc Germain"
date: "10/19/2023"
output: html_document
---

```{r}
suppressPackageStartupMessages({
  library(ggplot2)
  library(cowplot)
  library(chromVAR)
  library(SummarizedExperiment)
})
source("../Scripts/plot.R")
source("../Scripts/runMethods.R")
res <- readRDS("../withArchetypes/results.rds")
res <- renameMethods(res)
res <- res[which(!(res$method %in% c("Ridge-lm", # redundant with lasso
                                     "GCsmooth>fastMLM>limma"))),] # show in a later step
# remove non-basic chromvar/monalisa variants
res <- res[!grepl("scale|center|deviations|>Qt>|fewer|smaller|spearman|udt",res$method),]
res$relAUC[is.na(res$relAUC)] <- ifelse(is.na(res$rank[which(is.na(res$relAUC))]), NA, 0)
```


```{r, fig.width=8, fig.height=8.5}
ro <- rev(getOrder(res, values=c("sqrtRank","relAUC")))
co <- getOrder(res, values=c("sqrtRank","relAUC"), columns=TRUE)
h1 <- rankHeatmap2(res, doDraw=FALSE, column_title="Rank of true TF", row_names_gp=gpar(fontsize=10), row_order=ro, column_order = co, rankBreaks = c(1,10,30,60,100))
h2 <- suppressWarnings(relAUCplot2(res, row_order=ro, doDraw=FALSE,
                  column_title="Network score", column_order=co))
h <- grid.grabExpr(draw(h1 + h2, merge=TRUE))

res <- readRDS("../withArchetypes/results.rds")
res2 <- filterMethods(res, rename=FALSE)
res2$method <- gsub(":","",res2$method)
pr <- sensFDRplot(res2, useArch = FALSE) + 
  ggtitle("Top variant per method, at nominal p.adjust <= 0.5") +
  theme(plot.title=element_text(size=11),
        axis.title=element_text(size=10))
fig <- cowplot::plot_grid( h, pr,
  nrow=2, labels=LETTERS[1:2], scale=c(0.95), rel_heights = c(6,3)
)
fig
```

```{r}
pdf("Figure2.pdf", width=8, height=8.5)
fig
dev.off()
```